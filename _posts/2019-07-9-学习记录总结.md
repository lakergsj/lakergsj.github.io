---
layout:     post   				    # 使用的布局（不需要改）
title:      2019-07-9-学习记录总结			# 标题 
subtitle:   拆弹剩余阶段 #副标题
date:       2019-07-9 				# 时间
author:     GSJ 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 学习
---
# 拆弹补录（四五六阶段）
	由于之间兼职的原因，拆弹结束了很长时间都没有及时做记录。今天就把拆弹过程中的一些技巧和经验总结一下
 ## 拆弹第四阶段 <br>
首先要研究下func4 的功能。<br>
![](https://wx2.sinaimg.cn/mw690/005QXIrHly1g4x1jdninej30bu08jgll.jpg) <br>
容易看出是一个递归函数。lea 0xffffffff(%esi),%eax 是得到%esi-1 的值然后调用func4，同样lea 0xfffffffe(%esi),%eax 是得到%esi-2 的值然后调用func4，<br>lea (%eax,%ebx,1),%eax 即是将f（%esi-1）的返回值（在%ebx 里面）与f（%esi-2）的返回值相加放在%eax 中作为func4 的返回值，很明显这是一个斐波那契数列的函数。
cmp $0x59,%eax je 8048d3b <phase_4+0x45>
很清楚，当%eax 等于0x59 的时候就可以过关了。<br>%eax 是什么？是call 8048cb8 <func4>后的返回值！那此次调用的函数参数是什么呢？就是我们输入的东西了。8048d11 和8048d16 两句也说明了输入的是一个数字。然后把斐波那契数列一排，0x59 对应的序号为10，输入,解决。<br>
## 拆弹第五阶段 <br>
![](https://wx4.sinaimg.cn/mw690/005QXIrHly1g4x1u0v1qzj30co08zdft.jpg）<br>
首先，call 8048ff9 <string_length>和cmp $0x6,%eax 两句告诉我们要输入的是6 个字符。<br>在指令movsbl (%edx,%ebx,1),%eax 中，%ebx 为6 个字符的起始地址，通过循环增加%edx 的值来依次将这6 个字符的ASCII 码传给%eax进行下一步操作。<br>
说明一下movsbl (%edx,%ebx,1),%eax具体含义：我们知道，movsbl S ，D的意思是将S（不论寄存器还是内存地址）里面存放的值的一个最低位字节拷贝出来，<br>设置其高24位为此字节最高有效位，然后传送到D中。简单描述就是传送符号扩展的字节。因此，此指令的含义为将%ebx+%edx里面的内容（其实应该为一个地址），把这个地址中的值得最低位字节符号扩展，然后传送到%eax中。<br>
与movsbl相对的是movzbl，它是0扩展，其余与
movsbl 一样。<br> 研究下这句：movzbl 0x804a5c0(%eax),%eax。<br>
)，它的原型为Imm(Eb)，操作为M[Imm+R[Eb]],表示为（基址+偏移量）寻址，它很<br>
容易让我们联想到数组的操作。<br>
刚才已经说了%eax 是我们输入字符的ASCII 码，经过and $0xf,%eax 处理后也就是相应ASCII 码的低4 位。查看<br>
0x804a5c0 处存放的东西：
(gdb) x/s 0x804a5c0<br>
0x804a5c0 <array.0>: "isrveawhobpnutfgs/001"<br>
0x804a5c0(%eax) 的寻址方式说明了这条指令是将字符串"isrveawhobpnutfgs/001"中的第%eax 个字符传送<br>
给%eax，%eax 起到了一个索引的作用。循环6 次以后，以输入的6 个字符的的ASCII 码低4 位为索引得到的字符<br>
串"isrveawhobpnutfgs/001"中的6 个字符，被装入0xffffffe8(%ebp)为起始地址的连续存储空间中。<br>
接着可以看到8048d8a 处调用了strings_not_equal，8048d7c 处清楚地说明了比较的对象，查看0x804992f 处的字符串：<br>
(gdb) x/s 0x804992f<br>
0x804992f <_IO_stdin_used+523>: "giants"<br>
说明我们只要使索引得到的字符串为"giants"就可以了！<br>
反推回去，g、i、a、n、t、s 对应的索引值为15、0、5、11、13、1。<br>
所以只要使我们输入的6 个字符的ASCII 码低4 位依次为15 0 5 11 13 1 就可以了。
## 拆弹第六阶段 <br>
	![](https://wx4.sinaimg.cn/mw690/005QXIrHly1g4x257mxboj30c608vt8p.jpg）<br>
	第六个炸弹代码太长，应该步步调试来获取答案
