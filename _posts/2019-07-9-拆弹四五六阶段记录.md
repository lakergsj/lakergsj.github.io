---
layout:     post   				    # 使用的布局（不需要改）
title:      2019-07-9-拆弹四五六阶段记录			# 标题 
subtitle:   拆弹剩余阶段 #副标题
date:       2019-07-9 				# 时间
author:     GSJ 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 学习
---
# 拆弹补录（四五六阶段）
由于之间兼职的原因，拆弹结束了很长时间都没有及时做记录。今天就把拆弹过程中的一些技巧和经验总结一下<br>
## 拆弹第四阶段 <br>
首先要研究下phase_4阶段的代码 <br>
![](https://wx2.sinaimg.cn/mw690/005QXIrHly1g51rg10uexj30gd0bv405.jpg） <br>
首先采用gdb调试来查看此阶段要求我们输入的数据的格式。如图所示：<br>
![](https://wx2.sinaimg.cn/mw690/005QXIrHly1g51ridvv8rj30hm0dk14l.jpg） <br>
发现题目要求输入两个整型数据。由开头代码知输入的第一个数为2-14之间的一个数，此处我无 <br>
法确定这个数具体是几，先看第二个数，如下图：<br>
![](https://wx3.sinaimg.cn/mw690/005QXIrHly1g51rj5ps9nj30iw061mxr.jpg） <br>
由 十六进制0X2c知此数为十进制数35，第一个数依然无法确定，但我们已知它的范围，且范围 <br>
不大，于是暴力拆解，得最后答案为8 35.如图：<br>
![](https://wx3.sinaimg.cn/mw690/005QXIrHly1g51rkky35pj30gz07f7ar.jpg） <br>
## 拆弹第五阶段 <br>
![](https://wx4.sinaimg.cn/mw690/005QXIrHly1g4x1u0v1qzj30co08zdft.jpg）<br>
首先，call 8048ff9 <string_length>和cmp $0x6,%eax 两句告诉我们要输入的是6 个字符。<br>在指令movsbl (%edx,%ebx,1),%eax 中，%ebx 为6 个字符的起始地址，通过循环增加%edx 的值来依次将这6 个字符的ASCII 码传给%eax进行下一步操作。<br>
说明一下movsbl (%edx,%ebx,1),%eax具体含义：我们知道，movsbl S ，D的意思是将S（不论寄存器还是内存地址）里面存放的值的一个最低位字节拷贝出来，<br>设置其高24位为此字节最高有效位，然后传送到D中。简单描述就是传送符号扩展的字节。因此，此指令的含义为将%ebx+%edx里面的内容（其实应该为一个地址），把这个地址中的值得最低位字节符号扩展，然后传送到%eax中。<br>
与movsbl相对的是movzbl，它是0扩展，其余与
movsbl 一样。<br> 研究下这句：movzbl 0x804a5c0(%eax),%eax。<br>
)，它的原型为Imm(Eb)，操作为M[Imm+R[Eb]],表示为（基址+偏移量）寻址，它很<br>
容易让我们联想到数组的操作。<br>
刚才已经说了%eax 是我们输入字符的ASCII 码，经过and $0xf,%eax 处理后也就是相应ASCII 码的低4 位。查看<br>
0x804a5c0 处存放的东西：
(gdb) x/s 0x804a5c0<br>
0x804a5c0 <array.0>: "isrveawhobpnutfgs/001"<br>
0x804a5c0(%eax) 的寻址方式说明了这条指令是将字符串"isrveawhobpnutfgs/001"中的第%eax 个字符传送<br>
给%eax，%eax 起到了一个索引的作用。循环6 次以后，以输入的6 个字符的的ASCII 码低4 位为索引得到的字符<br>
串"isrveawhobpnutfgs/001"中的6 个字符，被装入0xffffffe8(%ebp)为起始地址的连续存储空间中。<br>
接着可以看到8048d8a 处调用了strings_not_equal，8048d7c 处清楚地说明了比较的对象，查看0x804992f 处的字符串：<br>
(gdb) x/s 0x804992f<br>
0x804992f <_IO_stdin_used+523>: "giants"<br>
说明我们只要使索引得到的字符串为"giants"就可以了！<br>
反推回去，g、i、a、n、t、s 对应的索引值为15、0、5、11、13、1。<br>
所以只要使我们输入的6 个字符的ASCII 码低4 位依次为15 0 5 11 13 1 就可以了。
## 拆弹第六阶段 <br>
![](https://wx4.sinaimg.cn/mw690/005QXIrHly1g4x257mxboj30c608vt8p.jpg）<br>
第六个炸弹代码太长，应该步步调试来获取答案
